<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Register — Ewoma Classicstore</title>

  <!-- favicon -->
  <link rel="icon" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1763817088/IMG-20250110-WA0108_pgxmqj.jpg">

  <!-- font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1: #eef6ff;
      --primary: #0b74ff;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.92);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      font-family: 'Poppins', system-ui, -apple-system, Roboto, Arial;
      background: linear-gradient(180deg, var(--bg1), #ffffff);
      color: #07203a;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
    }

    .card{
      width: min(96vw, 1100px);
      height: min(96vh, 860px);
      background: linear-gradient(180deg, var(--glass), #ffffff);
      border-radius:16px;
      box-shadow: 0 22px 60px rgba(12,40,80,0.08);
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:22px;
      overflow: hidden;
    }

    @media (max-width:880px){
      .card{grid-template-columns:1fr; height: 95vh; width: 96vw}
    }

    .visual{
      background: linear-gradient(135deg, rgba(11,116,255,0.04), rgba(11,116,255,0.01));
      padding:28px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
    }

    .logo{
      width:120px;height:120px;border-radius:16px;overflow:hidden;background:#fff;
      box-shadow: 0 10px 28px rgba(11,116,255,0.06);
      display:flex;align-items:center;justify-content:center;
    }
    .logo img{width:100%;height:100%;object-fit:cover;display:block}
    .brand{font-size:20px;color:var(--primary);font-weight:600}
    .lead{color:var(--muted);text-align:center;max-width:360px;padding:0 6px}

    .form-wrap{
      padding:28px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:12px;
      overflow:auto;
    }

    h1{font-size:22px;margin:0;color:var(--primary);font-weight:600}
    p.lead-form{margin:0;color:var(--muted);font-size:14px}

    form{display:flex;flex-direction:column;gap:12px;margin-top:6px}
    label{font-size:13px;color:var(--muted);margin-bottom:6px}
    .field{
      background:#fff;border-radius:12px;padding:12px;border:1px solid #eef7ff;display:flex;gap:10px;align-items:center;
    }
    .field input{border:0;outline:none;font-size:15px;width:100%;background:transparent}

    .small-row{display:flex;align-items:center;justify-content:space-between;font-size:13px;color:var(--muted)}
    .btn{
      padding:12px;border-radius:12px;border:0;background:var(--primary);color:#fff;font-weight:600;cursor:pointer;width:100%;
      box-shadow: 0 10px 30px rgba(11,116,255,0.08);
    }
    .muted{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}

    .msg{display:none;padding:10px;border-radius:8px;background:#fff6f6;border:1px solid #ffd6d6;color:#7a1b1b;font-size:14px;text-align:center}

    @media (max-width:420px){
      .logo{width:96px;height:96px}
      .brand{font-size:18px}
      h1{font-size:20px}
      .card{gap:14px;padding:10px}
      .visual{padding:18px}
      .form-wrap{padding:18px}
    }
  </style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="signupTitle">
    <div class="visual" aria-hidden="false">
      <div class="logo" aria-hidden="true">
        <img src="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1763817088/IMG-20250110-WA0108_pgxmqj.jpg" alt="Ewoma Classicstore logo" />
      </div>
      <div class="brand">Ewoma Classicstore</div>
      <div class="lead">Create an account to start shopping and save your favorite items.</div>
    </div>

    <div class="form-wrap">
      <h1 id="signupTitle">Create account</h1>
      <p class="lead-form">Register with a username, phone, email and password.</p>

      <div id="message" class="msg" role="status" aria-live="polite"></div>

      <form id="signupForm" autocomplete="on" novalidate>
        <div>
          <label for="username">Username</label>
          <div class="field">
            <input id="username" name="username" type="text" placeholder="choose a username" minlength="3" required autocomplete="username" />
          </div>
        </div>

        <div>
          <label for="phone">Phone number</label>
          <div class="field">
            <input id="phone" name="phone" type="tel" placeholder="+2348012345678" pattern="\\+?[0-9\\s-]{7,20}" required autocomplete="tel" />
          </div>
        </div>

        <div>
          <label for="email">Email</label>
          <div class="field">
            <input id="email" name="email" type="email" placeholder="you@example.com" required autocomplete="email" />
          </div>
        </div>

        <div>
          <label for="password">Password</label>
          <div class="field" style="position:relative">
            <input id="password" name="password" type="password" placeholder="create password (min 6 chars)" minlength="6" required autocomplete="new-password" />
            <button type="button" id="togglePwd" aria-label="Toggle password" style="background:none;border:0;cursor:pointer;margin-left:6px">Show</button>
          </div>
        </div>

        <div>
          <label for="confirm">Confirm password</label>
          <div class="field" style="position:relative">
            <input id="confirm" name="confirm" type="password" placeholder="confirm password" minlength="6" required autocomplete="new-password" />
            <button type="button" id="toggleConfirm" aria-label="Toggle confirm password" style="background:none;border:0;cursor:pointer;margin-left:6px">Show</button>
          </div>
        </div>

        <div class="small-row">
          <label style="display:flex;align-items:center;gap:8px"><input id="terms" type="checkbox" required /> I agree to the <a href="privacy-policy.html" class="link">privacy policy</a></label>
        </div>

        <button class="btn" type="submit" id="submitBtn">Create account</button>

        <div class="muted">Already have an account? <a href="signin.html" class="link">Sign in</a></div>
      </form>
    </div>
  </div>

  <!-- Firebase modular SDK + logic -->
  <script type="module">
    // Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs,
      setDoc,
      doc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // Firebase config (your provided details)
    const firebaseConfig = {
      apiKey: "AIzaSyAhsWovZGZEwqY1QRJygQ2toECTeQarmsM",
      authDomain: "ewomaclassicstore.firebaseapp.com",
      projectId: "ewomaclassicstore",
      storageBucket: "ewomaclassicstore.firebasestorage.app",
      messagingSenderId: "436665012312",
      appId: "1:436665012312:web:3b6f663ef44217e9c63a2d",
      measurementId: "G-Q090M73LVG"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e){ /* ignore analytics errors in some envs */ }

    const auth = getAuth(app);
    const db = getFirestore(app);

    // Elements
    const form = document.getElementById('signupForm');
    const usernameEl = document.getElementById('username');
    const phoneEl = document.getElementById('phone');
    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    const confirmEl = document.getElementById('confirm');
    const messageEl = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');
    const togglePwd = document.getElementById('togglePwd');
    const toggleConfirm = document.getElementById('toggleConfirm');

    function showMessage(text, isError = true, timeout = 6000){
      messageEl.textContent = text;
      messageEl.style.display = 'block';
      messageEl.style.background = isError ? '#fff6f6' : '#f3fff6';
      messageEl.style.borderColor = isError ? '#ffd6d6' : '#a6f3c0';
      messageEl.style.color = isError ? '#7a1b1b' : '#0a6d1f';
      if(timeout) setTimeout(()=> messageEl.style.display = 'none', timeout);
    }

    // Toggle password visibility
    togglePwd.addEventListener('click', () => {
      passwordEl.type = passwordEl.type === 'password' ? 'text' : 'password';
      togglePwd.textContent = passwordEl.type === 'password' ? 'Show' : 'Hide';
    });
    toggleConfirm.addEventListener('click', () => {
      confirmEl.type = confirmEl.type === 'password' ? 'text' : 'password';
      toggleConfirm.textContent = confirmEl.type === 'password' ? 'Show' : 'Hide';
    });

    // Check username uniqueness
    async function usernameExists(usernameLower){
      try {
        const q = query(collection(db, 'users'), where('username', '==', usernameLower));
        const snap = await getDocs(q);
        return !snap.empty;
      } catch(e){
        console.error('username check failed', e);
        // If check fails, be conservative and assume it exists to prevent duplicates
        return true;
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messageEl.style.display = 'none';

      const username = usernameEl.value.trim();
      const phone = phoneEl.value.trim();
      const email = emailEl.value.trim();
      const password = passwordEl.value;
      const confirm = confirmEl.value;

      // Basic client-side validation
      if(!username || username.length < 3){
        showMessage('Choose a username (min 3 characters).');
        return;
      }
      if(!phone){
        showMessage('Enter your phone number.');
        return;
      }
      if(!email){
        showMessage('Enter your email address.');
        return;
      }
      if(!password || password.length < 6){
        showMessage('Password must be at least 6 characters.');
        return;
      }
      if(password !== confirm){
        showMessage('Passwords do not match.');
        return;
      }

      // disable button to avoid duplicate submissions
      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating account...';

      const usernameLower = username.toLowerCase();

      // ensure username is unique
      const exists = await usernameExists(usernameLower);
      if(exists){
        showMessage('Username is already taken. Try another.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create account';
        return;
      }

      try {
        // Create Firebase Auth user
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Update displayName
        try {
          await updateProfile(user, { displayName: username });
        } catch(err){ console.warn('updateProfile failed', err); }

        // Write user doc in Firestore using UID as document id
        await setDoc(doc(db, 'users', user.uid), {
          username: usernameLower,
          phone,
          email,
          createdAt: serverTimestamp()
        });

        showMessage('Account created — redirecting to sign in...', false, 1500);
        setTimeout(()=> window.location.href = 'signin.html', 1400);
      } catch(err){
        console.error('signup error', err);
        // Friendly error messages
        let text = 'Could not create account. Try again.';
        if(err.code === 'auth/email-already-in-use') text = 'This email is already in use.';
        if(err.code === 'auth/invalid-email') text = 'Invalid email address.';
        if(err.code === 'auth/weak-password') text = 'Password is too weak.';
        showMessage(text);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create account';
      }
    });
  </script>
</body>
</html>
